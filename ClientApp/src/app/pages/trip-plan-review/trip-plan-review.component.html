@if (generatedPlan) {
  <app-header 
    [pageTitle]="'Itenerary Review'" 
    [pageSubtitle]="'Review and finalize your AI-generated trip plan'">
  </app-header>

  <div class="trip-review-container">
    <div class="review-header">
      <div class="header-content">
        <h1>{{ generatedPlan.trip.name || 'Trip Plan' }}</h1>
        <p class="trip-dates">
          {{ generatedPlan.trip.startDate | date: 'MMM d, yyyy' }} -
          {{ generatedPlan.trip.endDate | date: 'MMM d, yyyy' }}
        </p>
        <p class="trip-destination">{{ generatedPlan.trip.destination }}</p>
      </div>
      <div class="header-actions">
        <button mat-raised-button color="primary" (click)="acceptAndSaveTrip()">
          <mat-icon>check_circle</mat-icon>
          Save Trip
        </button>
        <button mat-stroked-button (click)="editTrip()">
          <mat-icon>edit</mat-icon>
          Edit
        </button>
      </div>
    </div>

    <div class="review-content">
      <!-- AI Notes Section -->
      @if (generatedPlan.aiNotes && generatedPlan.aiNotes.length > 0) {
        <mat-card class="ai-notes-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>lightbulb</mat-icon>
              AI Insights
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="notes-list">
              @for (note of generatedPlan.aiNotes; track $index) {
                <div class="note-item">
                  <mat-icon>check_circle_outline</mat-icon>
                  <span>{{ note }}</span>
                </div>
              }
            </div>
          </mat-card-content>
        </mat-card>
      }

      <!-- Budget Breakdown Section -->

      @if (generatedPlan.budget) {
      <mat-card class="budget-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>attach_money</mat-icon>
            Budget Breakdown
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="budget-breakdown">
            <div class="budget-item">
              <span class="label">Total Budget:</span>
              <span class="value total">{{ formatCurrency(generatedPlan.budget.total) }}</span>
            </div>
            <div class="budget-item">
              <span class="label">Accommodation (35%):</span>
              <span class="value">{{ formatCurrency(generatedPlan.budget.accommodation) }}</span>
            </div>
            <div class="budget-item">
              <span class="label">Food (25%):</span>
              <span class="value">{{ formatCurrency(generatedPlan.budget.food) }}</span>
            </div>
            <div class="budget-item">
              <span class="label">Activities (25%):</span>
              <span class="value">{{ formatCurrency(generatedPlan.budget.activities) }}</span>
            </div>
            <div class="budget-item">
              <span class="label">Transport (10%):</span>
              <span class="value">{{ formatCurrency(generatedPlan.budget.transport) }}</span>
            </div>
            <div class="budget-item">
              <span class="label">Other (5%):</span>
              <span class="value">{{ formatCurrency(generatedPlan.budget.other) }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
      }
      <!-- Must-See Attractions Section -->
      @if (generatedPlan.attractions && generatedPlan.attractions.length > 0) {
        <mat-card class="attractions-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>place</mat-icon>
              Must-See Attractions
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="attractions-list">
              @for (attraction of generatedPlan.attractions; track $index) {
                <div class="attraction-item">
                  <div class="attraction-header">
                    <h4>{{ attraction.name }}</h4>
                    @if (attraction.category) {
                      <span class="attraction-category">
                        {{ attraction.category }}
                      </span>
                    }
                  </div>
                  <p class="attraction-description">{{ attraction.description }}</p>
                  @if (attraction.estimatedCost) {
                    <div class="attraction-cost">
                      Est. Cost: {{ formatCurrency(attraction.estimatedCost) }}
                    </div>
                  }
                </div>
              }
            </div>
          </mat-card-content>
        </mat-card>
      }
      <!-- Signature Restaurants Section -->
      @if (generatedPlan.restaurants && generatedPlan.restaurants.length > 0) {
      <mat-card class="restaurants-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>restaurant</mat-icon>
            Signature Restaurants
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="restaurants-list">
            @for (restaurant of generatedPlan.restaurants; track $index) {
              <div class="restaurant-item">
                <div class="restaurant-header">
                  <h4>{{ restaurant.name }}</h4>
                  <span class="restaurant-cuisine">{{ restaurant.cuisine }}</span>
                </div>
                <p class="restaurant-description">{{ restaurant.description }}</p>
                @if (restaurant.specialty) {
                  <div class="restaurant-specialty">
                    <strong>Specialty:</strong> {{ restaurant.specialty }}
                  </div>
                }
                @if (restaurant.estimatedCost) {
                  <div class="restaurant-cost">
                    Est. Cost: {{ formatCurrency(restaurant.estimatedCost) }}
                  </div>
                }
              </div>
            }
          </div>
        </mat-card-content>
      </mat-card>
      }
    </div>

    <div class="review-footer">
      <button mat-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Back to Create
      </button>
    </div>
  </div>
}